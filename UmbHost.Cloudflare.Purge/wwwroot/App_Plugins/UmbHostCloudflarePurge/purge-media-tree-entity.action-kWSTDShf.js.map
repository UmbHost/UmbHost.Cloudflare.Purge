{"version":3,"file":"purge-media-tree-entity.action-kWSTDShf.js","sources":["../../../Client/src/trees/purge-media-tree-entity.action.ts"],"sourcesContent":["import { UmbEntityActionArgs, UmbEntityActionBase, UmbRequestReloadStructureForEntityEvent } from '@umbraco-cms/backoffice/entity-action';\r\nimport { UmbModalManagerContext, UMB_MODAL_MANAGER_CONTEXT, UMB_CONFIRM_MODAL } from '@umbraco-cms/backoffice/modal'\r\nimport { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbLocalizationController } from '@umbraco-cms/backoffice/localization-api';\r\nimport { UMB_ACTION_EVENT_CONTEXT } from '@umbraco-cms/backoffice/action';\r\nimport { UMB_NOTIFICATION_CONTEXT, UmbNotificationContext, UmbNotificationDefaultData } from '@umbraco-cms/backoffice/notification';\r\nimport { UmbMediaItemRepository } from '@umbraco-cms/backoffice/media';\r\n\r\nexport class PurgeCdnMediaEntityAction extends UmbEntityActionBase<never> {\r\n    private _notificationContext?: UmbNotificationContext;\r\n    #modalContext?: UmbModalManagerContext;\r\n    #localize = new UmbLocalizationController(this);\r\n\r\n    constructor(host: UmbControllerHost, args: UmbEntityActionArgs<never>) {\r\n        super(host, args);\r\n\r\n        this.consumeContext(UMB_NOTIFICATION_CONTEXT, (notificationContext) => {\r\n              this._notificationContext = notificationContext;\r\n            });\r\n\r\n        this.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n            this.#modalContext = instance;\r\n        });\r\n    }\r\n\r\n    async execute() {\r\n        const item = await this.#getMedia();\r\n        if (!item) return;\r\n\r\n        const modalHandler = this.#modalContext?.open(this, UMB_CONFIRM_MODAL, {\r\n            data: {\r\n                headline: this.#localize.term(\"umbhostCloudflarePurge_confirmpurgecdnentityactiontitle\"),\r\n                content: this.#localize.string(\"#umbhostCloudflarePurge_confirmpurgecdnentityactioncontent\", item.name),\r\n                color: 'danger',\r\n            }\r\n        });\r\n\r\n        await modalHandler?.onSubmit().then(() => {\r\n            const data: UmbNotificationDefaultData = { headline: this.#localize.string(\"#umbhostCloudflarePurge_purgeitemsuccesstitle\", item.name), message: this.#localize.term(\"umbhostCloudflarePurge_purgeitemsuccesscontent\") };\r\n                  this._notificationContext?.peek('positive', { data });\r\n\r\n                  this.#notify();\r\n        }).catch(() => {\r\n        });\r\n    }\r\n\r\n    async #getMedia() {\r\n        if (!this.args.unique) throw new Error('Cannot purge an item without a unique identifier.');\r\n\r\n\t\tconst { data } = await new UmbMediaItemRepository(this).requestItems([this.args.unique]);\r\n\t\tconst item = data?.[0];\r\n\t\tif (!item) throw new Error('Item not found.');\r\n\t\treturn item;\r\n\t}\r\n\r\n    async #notify() {\r\n\t\tconst actionEventContext = await this.getContext(UMB_ACTION_EVENT_CONTEXT);\r\n\t\tif (!actionEventContext) {\r\n\t\t\tthrow new Error('Action event context not found.');\r\n\t\t}\r\n\r\n\t\tconst event = new UmbRequestReloadStructureForEntityEvent({\r\n\t\t\tunique: this.args.unique,\r\n\t\t\tentityType: this.args.entityType,\r\n\t\t});\r\n\r\n\t\tactionEventContext.dispatchEvent(event);\r\n\t}\r\n}\r\n\r\nexport { PurgeCdnMediaEntityAction as api };"],"names":["PurgeCdnMediaEntityAction","UmbEntityActionBase","host","args","__privateAdd","_PurgeCdnMediaEntityAction_instances","_modalContext","_localize","UmbLocalizationController","UMB_NOTIFICATION_CONTEXT","notificationContext","UMB_MODAL_MANAGER_CONTEXT","instance","__privateSet","item","__privateMethod","getMedia_fn","modalHandler","_a","__privateGet","UMB_CONFIRM_MODAL","data","notify_fn","UmbMediaItemRepository","actionEventContext","UMB_ACTION_EVENT_CONTEXT","event","UmbRequestReloadStructureForEntityEvent"],"mappings":";;;;;;;;;;;;AAQO,MAAMA,UAAkCC,EAA2B;AAAA,EAKtE,YAAYC,GAAyBC,GAAkC;AACnE,UAAMD,GAAMC,CAAI;AANjB,IAAAC,EAAA,MAAAC;AAEH,IAAAD,EAAA,MAAAE;AACA,IAAAF,EAAA,MAAAG,GAAY,IAAIC,EAA0B,IAAI;AAKrC,SAAA,eAAeC,GAA0B,CAACC,MAAwB;AACjE,WAAK,uBAAuBA;AAAA,IAAA,CAC7B,GAEA,KAAA,eAAeC,GAA2B,CAACC,MAAa;AACzD,MAAAC,EAAA,MAAKP,GAAgBM;AAAA,IAAA,CACxB;AAAA,EAAA;AAAA,EAGL,MAAM,UAAU;;AACN,UAAAE,IAAO,MAAMC,EAAA,MAAKV,GAAAW,GAAL;AACnB,QAAI,CAACF,EAAM;AAEX,UAAMG,KAAeC,IAAAC,EAAA,MAAKb,OAAL,gBAAAY,EAAoB,KAAK,MAAME,GAAmB;AAAA,MACnE,MAAM;AAAA,QACF,UAAUD,EAAA,MAAKZ,GAAU,KAAK,yDAAyD;AAAA,QACvF,SAASY,EAAA,MAAKZ,GAAU,OAAO,8DAA8DO,EAAK,IAAI;AAAA,QACtG,OAAO;AAAA,MAAA;AAAA,IACX;AAGJ,WAAMG,KAAA,gBAAAA,EAAc,WAAW,KAAK,MAAM;;AACtC,YAAMI,IAAmC,EAAE,UAAUF,EAAA,MAAKZ,GAAU,OAAO,iDAAiDO,EAAK,IAAI,GAAG,SAASK,EAAA,MAAKZ,GAAU,KAAK,gDAAgD,EAAE;AACjN,OAAAW,IAAA,KAAK,yBAAL,QAAAA,EAA2B,KAAK,YAAY,EAAE,MAAAG,MAE9CN,EAAA,MAAKV,GAAAiB,GAAL;AAAA,IAAa,GACpB,MAAM,MAAM;AAAA,IAAA;AAAA,EACd;AAyBT;AA1DIhB,IAAA,eACAC,IAAA,eAHGF,IAAA,eAsCGW,IAAY,iBAAA;AACd,MAAI,CAAC,KAAK,KAAK,OAAc,OAAA,IAAI,MAAM,mDAAmD;AAEhG,QAAM,EAAE,MAAAK,EAAA,IAAS,MAAM,IAAIE,EAAuB,IAAI,EAAE,aAAa,CAAC,KAAK,KAAK,MAAM,CAAC,GACjFT,IAAOO,KAAA,gBAAAA,EAAO;AACpB,MAAI,CAACP,EAAY,OAAA,IAAI,MAAM,iBAAiB;AACrC,SAAAA;AAAA,GAGCQ,IAAU,iBAAA;AAClB,QAAME,IAAqB,MAAM,KAAK,WAAWC,CAAwB;AACzE,MAAI,CAACD;AACE,UAAA,IAAI,MAAM,iCAAiC;AAG5C,QAAAE,IAAQ,IAAIC,EAAwC;AAAA,IACzD,QAAQ,KAAK,KAAK;AAAA,IAClB,YAAY,KAAK,KAAK;AAAA,EAAA,CACtB;AAED,EAAAH,EAAmB,cAAcE,CAAK;AAAA;"}